<h1>Task 4</h1>

<div class="code-snippet">
    <div class="code response">
        <div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2020-04-08T18:48:31.334Z\&quot; agent=\&quot;5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\&quot; etag=\&quot;LnVOSLTBN8SJIa92wbG9\&quot; version=\&quot;12.9.9\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;C5RBs43oDa-KdzZeNtuy\&quot; name=\&quot;Page-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
    </div>
</div>
<script type="text/javascript" src="https://app.diagrams.net/js/viewer.min.js"></script>

<div class="code-snippet">
    <div class="code response">
        </?php<br>
        <br>
        /**<br>
        * See init method to run script.<br>
        */<br>
        class update_product_list<br>
        {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;public function __construct()<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->suppliers = [];<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->import_products = [];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->delete_products = [];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->update_products = [];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Array of suppliers and product csv import urls.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return array<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function get_suppliers()<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new suppliers_list;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// return [<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// [<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'name' => 'supplier 1',<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'product_feed' => 'https://www.example-site.com/product_feed.csv',<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'id' => 01,<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ],<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// ];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Get array of products from external csv source.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param string $product_feed<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param int $supplier_id<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return array|null<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function get_product_data($product_feed, $supplier_id)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Use fgetcsv loop over and get product data:<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $product_data = [<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'ean_number' => $data['ean_number'],<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'price'=> $data['product_price'],<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'supplier_id' => $supplier_id,<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// store_imported_product($product_data);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// return true;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Check if product is already included in import_products list<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * If true, check product price<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * else add to import_products<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function store_imported_product($product)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($this->import_products as &$import_product) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if not set<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $this->import_products[] = $product;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if product already set but is more expensive<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// update stored product details<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $import_product['price'] = $product<br>['price'];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $import_product['supplier_id'] = $product<br>['supplier_id'];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Find db product in import products array<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param object $db_product<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return int|null<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function find_db_product_in_import($db_product)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($this->import_products as $key => $product) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if ($product['ean_number'] === $db_product['ean_number'])<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp; return $key;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// }<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return null;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Handle connect to db in one method.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param string $query<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param string [$type = null]<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function connect_to_db($query, $type = null)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// connect to db<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// test connection<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fail -> echo 'db connection error.';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// run mysqli_multi_query<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// close connection<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if isset($type) && $type === 'SELECT'<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return results_to_array($results);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// else<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return true;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Get all products currently stored in db.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return array<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function get_db_products()<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// $query = 'SELECT product_id, ean_number, product_price, supplier_id FROM products';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// $results = $this->connect_to_db($query, 'SELECT');<br>
        &nbsp;&nbsp;&nbsp;&nbsp;//<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// return $results;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Create UPDATE stored product price query.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param array $products<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return string<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function write_update_price_query($products)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// foreach product<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $query .= <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// set price<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//  set deleted_at = null<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return $query;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Create UPDATE Soft delete product query.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Set a deleted_at timestamp so to avoid hard deleting product from db.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param array $products<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return string<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function write_delete_products_query($products)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// foreach product<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $query .=<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//  set deleted_at = NOW()<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return $query;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Write INSERT products to db query.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; *<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @param array $products<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * @return string<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function write_insert_products_query($products)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// foreach product<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// $query .=<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// insert (ean_number, product_price, supplier_id)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return $query;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
        &nbsp;&nbsp;&nbsp;&nbsp; * Run script.<br>
        &nbsp;&nbsp;&nbsp;&nbsp; */<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function init()<br>
        &nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->suppliers = $this->get_suppliers();<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($this->suppliers as $supplier) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'Retrieving products list for: ' . $supplier['name'] . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Build $this->import_products array<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->get_product_data($supplier['product_feed'], $supplier['id']);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'Retrieving products from db' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db_products = $this->get_db_products();<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($db_products as $db_product) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$index = $this->find_db_product_in_import($db_product);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// allow for index to be 0<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!isset($index))<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// db product not found in import products<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (true /* $db_product['supplier_id'] exists in $this->suppliers[] <br>*/)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'Product ID: ' . $db_product<br>['product_id'] . ' is to be deleted' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->delete_products[] = $db_product;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// filter product from import products array<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$product = $this->import_products[$index];<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// only new products are to remain in import_products array<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset($this->import_products[$index]);<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($product['price'] < $db_product['price'] ||<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isset($db_product['deleted_at']))<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this->update_products[] = $product;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query = null;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query .= $this->write_delete_products_query($this->delete_products);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query .= $this->write_update_price_query($this->update_products);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query .= $this->write_insert_products_query($this->import_products);<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$query)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'There is nothing to update.' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result = $this->connect_to_db($query);<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($result)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'Product import completed successfully.' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo count($this->delete_products) . ' products removed' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo count($this->update_products) . ' products updated' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo count($this->import_products) . ' products added' . PHP_EOL;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        }<br>
        <br>        
    </div>
</div>
